---
title: "**åœ°å›³ã§æ¢ã™ã€Œ2025ãƒãƒ­ã‚¦ã‚£ãƒ¼ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆğŸƒã€**"
description: "å…¨å›½ã®ãƒãƒ­ã‚¦ã‚£ãƒ¼ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã‚’åœ°å›³ã‹ã‚‰æ¢ã™ã“ã¨ãŒã§ãã¾ã™ã€‚"
format:
    dashboard: 
        orientation: columns
page-footer: false
---

```{r}
#| echo: false
#| output: false

# ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª­ã¿è¾¼ã¿
library(leaflet)
library(leaflet.extras)
library(DT)
library(crosstalk)
library(dplyr)
library(htmltools)

# ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
event_data <- read.csv("./r7event.csv", fileEncoding = "UTF-8", stringsAsFactors = FALSE)

# å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã‚’é¸æŠãƒ»åŠ å·¥
event_data <- event_data %>% 
    mutate(lat = as.numeric(lat),lon = as.numeric(lon)) %>%
# è¡¨ã¨åœ°å›³ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®ãŸã‚ã®æ“ä½œ
    mutate(table_title = paste0("<a href='",url,"'>",name,"</a>")) %>%
    mutate(table_daystart = format(as.Date(daystart), "%m/%d")) %>%
    mutate(table_dayend = format(as.Date(dayend), "%m/%d")) %>%
    mutate(lab = as.character(paste0("<img src='",fig,"'width='300'/><br><br><h5>",name,"</h5><br><strong>æ—¥æ™‚ï¼š",table_daystart,"ã‹ã‚‰",table_dayend,"ã¾ã§</strong><br><strong>URLï¼š</strong><a href='",url,"'>",url,"</a><br>",description)))

order <- c("table_title", "place", "pref","table_daystart", "table_dayend", "lab","lat","lon")

shared_event_data <- SharedData$new(event_data[,order], group = "event_selection")

events_total <- nrow(event_data)
events_today <- 2

```

# ãƒãƒ­ã‚¦ã‚£ãƒ¼ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒƒãƒ— {orientation="columns" scrolling="false"}

## Column {width="40%"}

### Row {height="20%"}
```{r}
#| content: valuebox
#| title: "ç™»éŒ²ã‚¤ãƒ™ãƒ³ãƒˆæ•°"
list(
  #icon = "trash",
  color = "#f4d1a5ff",
  value = events_total
)
```

```{r}
#| content: valuebox
#| title: "æœ¬æ—¥ã®ã‚¤ãƒ™ãƒ³ãƒˆæ•°"
list(
  #icon = "trash",
  color = "#babbe4ff",
  value = 0
)
```

::: {.card title="ãŠå•ã„åˆã‚ã›" expandable='false'}
ãŠæ‰‹æ•°ã§ã™ãŒã€ç™»éŒ²ãƒ»ä¿®æ­£ãƒ»å‰Šé™¤ãƒ»ãŠå•ã„åˆã‚ã›ã®æ–¹ã¯ã“ã¡ã‚‰ã¾ã§ã”é€£çµ¡ãã ã•ã‚Œã°å¹¸ã„ã§ã™ã€‚
:::

### Row

```{r}
#| title: ãƒãƒ­ã‚¦ã‚£ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
#c("table_title", "place", "pref","table_daystart", "table_dayend", "lab","lat","lon")
datatable(
  shared_event_data,
  colnames = c("ã‚¤ãƒ™ãƒ³ãƒˆå","é–‹å‚¬å ´æ‰€","éƒ½é“åºœçœŒ","é–‹å§‹","çµ‚äº†"),
  extensions = 'Scroller',
  escape = FALSE, 
  rownames = FALSE,
  options = list(
    columnDefs = list(list(visible = FALSE, targets = c("lab",'lat','lon'))),
    deferRender = TRUE,
    dom = "frtiS",
    scrollCollapse = TRUE,
     initComplete = JS(
        "function(settings, json) {",
        "$(this.api().table().container()).css({'font-size': '85%'});",
        "}")
  ),
  selection = 'single',
  width = "100%"
)
```

## Column

```{r map}
#| echo: false
#| padding: 0px
#| title: ğŸƒãƒãƒ­ã‚¦ã‚£ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒƒãƒ—ğŸƒ
lab = sprintf(
  "<img src='./logo.png' width='20'/>
  <br/>
  <strong>%s</strong>
  <br/>%s",
  shared_event_data$name, 
  shared_event_data$description
) %>% lapply(htmltools::HTML)

map <- leaflet(shared_event_data) %>%
  addTiles() %>%
  setView(lng = 139.86, lat = 35.7, zoom = 12) %>%
  addMarkers(lng = ~lon, lat = ~lat, popup = ~lab) %>%
  addControlGPS(
    options = gpsOptions(
      position = "topleft",
      activate = TRUE, 
      autoCenter = TRUE,
      setView = TRUE))
activateGPS(map)
```

# ãŠã™ã™ã‚ã®ãƒãƒ­ã‚¦ã‚£ãƒ¼ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆç‰¹é›† {orientation="columns" scrolling="false"}
